<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planejamento Fluvial - Segurança Empresarial</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .header {
      background-color: #4F8A50;
      color: white;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
    }
    .header img {
      height: 40px;
      margin-right: 15px;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    .info-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .authors {
      display: flex;
      justify-content: space-between;
    }
    .authors-left {
      display: flex;
      flex-direction: column;
    }
    .authors-right {
      text-align: right;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .form-control {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }
    .crew-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .crew-container {
      margin-bottom: 15px;
    }
    .crew-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    .crew-table th, .crew-table td {
      padding: 8px;
      text-align: left;
      border: 1px solid #ddd;
    }
    .crew-table th {
      background-color: #f2f2f2;
    }
    .btn {
      background-color: #4F8A50;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #3a6b3b;
    }
    .btn-remove {
      background-color: #dc3545;
    }
    .btn-remove:hover {
      background-color: #b02a37;
    }
    .section-title {
      background-color: #4F8A50;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .operation-details {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 15px;
    }
    .location-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .form-container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 15px;
    }
    .item {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .item label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    .inspetores {
      margin-top: 30px;
      border-top: 1px solid #ddd;
      padding-top: 20px;
      text-align: center;
    }
    .inspetores h3 {
      margin-bottom: 20px;
    }
    .inspetores-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .inspetor {
      display: flex;
      flex-direction: column;
    }
    .inspetor input {
      padding: 8px;
      margin-bottom: 10px;
    }
    .inspetor-label {
      font-weight: bold;
      margin-top: 10px;
    }
    .submit-buttons {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }
    .status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
      text-align: center;
      display: none;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
    @media (max-width: 768px) {
      .crew-section, .operation-details, .location-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://www.jirauenergia.com.br/wp-content/uploads/2021/06/cropped-logo-jirau-energia-1-1.png" alt="Jirau Energia">
    <h1>PLANEJAMENTO FLUVIAL - SEGURANÇA EMPRESARIAL</h1>
  </div>
  
  <div class="info-section">
    <div class="authors">
      <div class="authors-left">
        <p>Autor: Andeilsson Amaral</p>
        <p>Autor: Kaique Santos</p>
        <p>Aprovação: Airton Pedrozo</p>
      </div>
      <div class="authors-right">
        <p>Implantação: 27/02/2024</p>
        <p>Rev: 06/02/2025</p>
      </div>
    </div>
    
    <div class="form-group">
      <label>Responsável pela Operação</label>
      <div class="form-row">
        <select id="responsavelSelect" class="form-control">
          <option value="1683">Airton Pedrozo</option>
          <option value="1">Clemerson Santos De Souza</option>
          <option value="2">Flavio da Silva Paralego</option>
          <option value="3">Kaique Lopes Dos Santos</option>
          <option value="4">Larissa Mendes</option>
          <option value="5">Lucas Silva Corres</option>
        </select>
        <input type="text" id="responsavelId" value="1683" class="form-control" style="max-width: 100px;" readonly>
      </div>
    </div>
    
    <div class="form-group">
      <label>Piloto Principal</label>
      <div class="form-row">
        <input type="text" id="pilotoNome" class="form-control" value="Kaique Lopes Dos Santos">
        <input type="text" id="pilotoId" class="form-control" value="1705" style="max-width: 100px;">
      </div>
    </div>
    
    <div class="crew-section">
      <div class="crew-container">
        <h3>Tripulantes</h3>
        <table class="crew-table" id="tripulantesTable">
          <thead>
            <tr>
              <th>Nome</th>
              <th>ID</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" class="form-control tripulante-nome" value=""></td>
              <td><input type="text" class="form-control tripulante-id" value=""></td>
              <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
            </tr>
            <tr>
              <td><input type="text" class="form-control tripulante-nome" value=""></td>
              <td><input type="text" class="form-control tripulante-id" value=""></td>
              <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
            </tr>
          </tbody>
        </table>
        <button class="btn" onclick="adicionarTripulante()">Adicionar Tripulante</button>
      </div>
      
      <div class="crew-container">
        <h3>Responsáveis da Logística</h3>
        <table class="crew-table" id="logisticaTable">
          <thead>
            <tr>
              <th>Nome</th>
              <th>ID</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" class="form-control logistica-nome" value=""></td>
              <td><input type="text" class="form-control logistica-id" value=""></td>
              <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
            </tr>
            <tr>
              <td><input type="text" class="form-control logistica-nome" value=""></td>
              <td><input type="text" class="form-control logistica-id" value=""></td>
              <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
            </tr>
            <tr>
              <td><input type="text" class="form-control logistica-nome" value=""></td>
              <td><input type="text" class="form-control logistica-id" value=""></td>
              <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
            </tr>
          </tbody>
        </table>
        <button class="btn" onclick="adicionarLogistica()">Adicionar Responsável</button>
      </div>
    </div>
  </div>
  
  <div class="info-section">
    <div class="section-title">FISCALIZAÇÃO APP</div>
    
    <div class="operation-details">
      <div class="form-group">
        <label>Data</label>
        <input type="date" id="dataOperacao" class="form-control">
      </div>
      <div class="form-group">
        <label>Hora</label>
        <input type="time" id="horaOperacao" class="form-control">
      </div>
      <div class="form-group">
        <label>Status</label>
        <select id="statusOperacao" class="form-control">
          <option value="Pendente">Pendente</option>
          <option value="Em Andamento">Em Andamento</option>
          <option value="Concluído">Concluído</option>
        </select>
      </div>
    </div>
    
    <div class="form-group">
      <label>Local alvo/final</label>
      <input type="text" id="localAlvo" class="form-control">
    </div>
    
    <div class="location-section">
      <div class="form-group">
        <label>Local concentração/início</label>
        <input type="text" id="localInicio" class="form-control">
      </div>
      <div class="form-group">
        <label>Tempo previsto de duração</label>
        <input type="text" id="tempoDuracao" class="form-control">
      </div>
    </div>
  </div>
  
  <div class="form-container">
    <div class="section-title">Check de Logística - NOTURNA PRÉ OPERAÇÃO</div>
    
    <div class="items-grid">
      <div class="item">
        <label>Rádios HT C/ BATERIAS RESERVAS</label>
        <input type="radio" id="radios-sim" name="radios" value="SIM"> SIM
        <input type="radio" id="radios-nao" name="radios" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Celular corporativo com carga</label>
        <input type="radio" id="celular-sim" name="celular" value="SIM"> SIM
        <input type="radio" id="celular-nao" name="celular" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Body Cam</label>
        <input type="radio" id="bodycam-sim" name="bodycam" value="SIM"> SIM
        <input type="radio" id="bodycam-nao" name="bodycam" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Doc. Da Embarcação</label>
        <input type="radio" id="doc-embarcacao-sim" name="docEmbarcacao" value="SIM"> SIM
        <input type="radio" id="doc-embarcacao-nao" name="docEmbarcacao" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Drone</label>
        <input type="radio" id="drone-sim" name="drone" value="SIM"> SIM
        <input type="radio" id="drone-nao" name="drone" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Doc. Do Reboque</label>
        <input type="radio" id="doc-reboque-sim" name="docReboque" value="SIM"> SIM
        <input type="radio" id="doc-reboque-nao" name="docReboque" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Garrafa Térmica C/ ÁGUA</label>
        <input type="radio" id="garrafa-sim" name="garrafa" value="SIM"> SIM
        <input type="radio" id="garrafa-nao" name="garrafa" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Coletes salva vidas</label>
        <input type="radio" id="coletes-sim" name="coletes" value="SIM"> SIM
        <input type="radio" id="coletes-nao" name="coletes" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Telefone satelital C/ CARGA</label>
        <input type="radio" id="telefone-sim" name="telefone" value="SIM"> SIM
        <input type="radio" id="telefone-nao" name="telefone" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Corrente com cadeados</label>
        <input type="radio" id="corrente-sim" name="corrente" value="SIM"> SIM
        <input type="radio" id="corrente-nao" name="corrente" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Kit 1° Socorros</label>
        <input type="radio" id="kit-sim" name="kit" value="SIM"> SIM
        <input type="radio" id="kit-nao" name="kit" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>VTR COM 100% DE COMBUSTÍVEL</label>
        <input type="radio" id="vtr-sim" name="vtr" value="SIM"> SIM
        <input type="radio" id="vtr-nao" name="vtr" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Lanternas</label>
        <input type="radio" id="lanternas-sim" name="lanternas" value="SIM"> SIM
        <input type="radio" id="lanternas-nao" name="lanternas" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>DOCUMENTAÇÕES</label>
        <input type="radio" id="documentacoes-sim" name="documentacoes" value="SIM"> SIM
        <input type="radio" id="documentacoes-nao" name="documentacoes" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Facão</label>
        <input type="radio" id="facao-sim" name="facao" value="SIM"> SIM
        <input type="radio" id="facao-nao" name="facao" value="NÃO"> NÃO
      </div>
      
      <div class="item">
        <label>Spray de Pimenta</label>
        <input type="radio" id="spray-sim" name="spray" value="SIM"> SIM
        <input type="radio" id="spray-nao" name="spray" value="NÃO"> NÃO
      </div>
    </div>
    
    <div class="inspetores">
      <h3>RESPONSÁVEIS PELO CHECK</h3>
      <div class="inspetores-grid">
        <div class="inspetor">
          <input type="text" id="inspetor1" name="inspetor1" placeholder="Nome do Inspetor 01" class="form-control">
          <div class="inspetor-label">INSPETOR 01</div>
        </div>
        <div class="inspetor">
          <input type="text" id="inspetor2" name="inspetor2" placeholder="Nome do Inspetor 02" class="form-control">
          <div class="inspetor-label">INSPETOR 02</div>
        </div>
      </div>
    </div>
    
    <div class="submit-buttons">
      <button type="button" id="btnSalvar" onclick="salvarChecklist()" class="btn">Salvar Checklist</button>
      <button type="button" onclick="imprimirChecklist()" class="btn">Imprimir</button>
    </div>
    
    <div id="statusMessage" class="status"></div>
  </div>

  <script>
    // URL do Web App - SUBSTITUA PELA SUA URL
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzyQztaTjDtAqy00GU8KfkOkEHhsvFHsiuP7UsJ_dAZABBhxpRfgb6TDbyXIIMKC3Bs/exec";
    
    // Inicialização da data e hora atuais
    document.addEventListener('DOMContentLoaded', function() {
      const hoje = new Date();
      const dataFormatada = hoje.toISOString().split('T')[0];
      const horaFormatada = hoje.getHours().toString().padStart(2, '0') + ':' + 
                           hoje.getMinutes().toString().padStart(2, '0');
      
      document.getElementById('dataOperacao').value = dataFormatada;
      document.getElementById('horaOperacao').value = horaFormatada;
    });
    
    // Event listener para o select de responsável
    document.getElementById('responsavelSelect').addEventListener('change', function() {
      document.getElementById('responsavelId').value = this.value;
    });
    
    // Funções para gerenciar tripulantes e logística
    function adicionarTripulante() {
      const table = document.getElementById('tripulantesTable').getElementsByTagName('tbody')[0];
      const newRow = table.insertRow();
      newRow.innerHTML = `
        <td><input type="text" class="form-control tripulante-nome" value=""></td>
        <td><input type="text" class="form-control tripulante-id" value=""></td>
        <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
      `;
    }
    
    function adicionarLogistica() {
      const table = document.getElementById('logisticaTable').getElementsByTagName('tbody')[0];
      const newRow = table.insertRow();
      newRow.innerHTML = `
        <td><input type="text" class="form-control logistica-nome" value=""></td>
        <td><input type="text" class="form-control logistica-id" value=""></td>
        <td><button class="btn btn-remove" onclick="removerLinha(this)">X</button></td>
      `;
    }
    
    function removerLinha(button) {
      const row = button.closest('tr');
      row.parentNode.removeChild(row);
    }
    
    // Função para coletar os dados dos tripulantes e logística
    function coletarDadosEquipe() {
      const tripulantes = [];
      document.querySelectorAll('#tripulantesTable tbody tr').forEach(row => {
        const nome = row.querySelector('.tripulante-nome').value.trim();
        const id = row.querySelector('.tripulante-id').value.trim();
        if (nome || id) {
          tripulantes.push({ nome, id });
        }
      });
      
      const logistica = [];
      document.querySelectorAll('#logisticaTable tbody tr').forEach(row => {
        const nome = row.querySelector('.logistica-nome').value.trim();
        const id = row.querySelector('.logistica-id').value.trim();
        if (nome || id) {
          logistica.push({ nome, id });
        }
      });
      
      return { tripulantes, logistica };
    }
    
    // Função para salvar o checklist
    function salvarChecklist() {
      // Desabilitar botão
      const btnSalvar = document.getElementById('btnSalvar');
      btnSalvar.disabled = true;
      btnSalvar.textContent = 'Salvando...';
      
      // Limpar mensagem anterior
      document.getElementById('statusMessage').innerHTML = '';
      document.getElementById('statusMessage').className = 'status';
      document.getElementById('statusMessage').style.display = 'none';
      
      // Coletar dados gerais do form
      const dadosGerais = {
        responsavel: {
          nome: document.getElementById('responsavelSelect').options[document.getElementById('responsavelSelect').selectedIndex].text,
          id: document.getElementById('responsavelId').value
        },
        piloto: {
          nome: document.getElementById('pilotoNome').value,
          id: document.getElementById('pilotoId').value
        },
        operacao: {
          data: document.getElementById('dataOperacao').value,
          hora: document.getElementById('horaOperacao').value,
          status: document.getElementById('statusOperacao').value,
          localAlvo: document.getElementById('localAlvo').value,
          localInicio: document.getElementById('localInicio').value,
          tempoDuracao: document.getElementById('tempoDuracao').value
        }
      };
      
      // Coletar dados da equipe
      const dadosEquipe = coletarDadosEquipe();
      
      // Coletar dados dos itens de checklist
      const items = [
        'radios', 'celular', 'bodycam', 'docEmbarcacao', 'drone', 
        'docReboque', 'garrafa', 'coletes', 'telefone', 'corrente',
        'kit', 'vtr', 'lanternas', 'documentacoes', 'facao', 'spray'
      ];
      
      const itensChecklist = [];
      items.forEach(item => {
        const radioSelecionado = document.querySelector(`input[name="${item}"]:checked`);
        itensChecklist.push({
          nome: document.querySelector(`label[for="${item}-sim"]`)?.textContent || item,
          status: radioSelecionado ? radioSelecionado.value : 'não_preenchido'
        });
      });
      
      // Preparar todos os dados
      const todosOsDados = {
        action: 'salvarChecklistNoturno',
        dadosGerais: JSON.stringify(dadosGerais),
        tripulantes: JSON.stringify(dadosEquipe.tripulantes),
        logistica: JSON.stringify(dadosEquipe.logistica),
        itensChecklist: JSON.stringify(itensChecklist),
        inspetor1: document.getElementById('inspetor1').value,
        inspetor2: document.getElementById('inspetor2').value
      };
      
      // Preparar dados no formato URL-encoded
      const params = new URLSearchParams();
      for (const key in todosOsDados) {
        params.append(key, todosOsDados[key]);
      }
      
      // Enviar dados usando XMLHttpRequest
      const xhr = new XMLHttpRequest();
      xhr.open('POST', WEB_APP_URL, true);
      
      // Configurar cabeçalhos
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      
      // Configurar handlers
      xhr.onload = function() {
        btnSalvar.disabled = false;
        btnSalvar.textContent = 'Salvar Checklist';
        
        if (xhr.status === 200) {
          try {
            const response = JSON.parse(xhr.responseText);
            if (response.status === 'success') {
              // Sucesso
              document.getElementById('statusMessage').innerHTML = response.message;
              document.getElementById('statusMessage').className = 'status success';
              document.getElementById('statusMessage').style.display = 'block';
            } else {
              // Erro retornado pelo servidor
              document.getElementById('statusMessage').innerHTML = response.message;
              document.getElementById('statusMessage').className = 'status error';
              document.getElementById('statusMessage').style.display = 'block';
            }
          } catch (e) {
            // Erro ao processar resposta
            document.getElementById('statusMessage').innerHTML = 'Erro ao processar resposta do servidor';
            document.getElementById('statusMessage').className = 'status error';
            document.getElementById('statusMessage').style.display = 'block';
          }
        } else {
          // Erro HTTP
          document.getElementById('statusMessage').innerHTML = 'Erro ao comunicar com o servidor';
          document.getElementById('statusMessage').className = 'status error';
          document.getElementById('statusMessage').style.display = 'block';
        }
      };
      
      xhr.onerror = function() {
        // Erro de rede
        btnSalvar.disabled = false;
        btnSalvar.textContent = 'Salvar Checklist';
        document.getElementById('statusMessage').innerHTML = 'Erro de conexão. Verifique sua internet.';
        document.getElementById('statusMessage').className = 'status error';
        document.getElementById('statusMessage').style.display = 'block';
      };
      
      // Enviar a requisição
      xhr.send(params.toString());
    }
    
    // Função para imprimir
    function imprimirChecklist() {
      window.print();
    }
  </script>
</body>
</html>
